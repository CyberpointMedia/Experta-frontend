plugins {
    id "com.android.application"
    id 'com.google.gms.google-services' // FlutterFire Configuration
    id "kotlin-android"
    id "dev.flutter.flutter-gradle-plugin"
}

def localProperties = new Properties()
def localPropertiesFile = rootProject.file('local.properties')
if (localPropertiesFile.exists()) {
    localPropertiesFile.withReader('UTF-8') { reader ->
        localProperties.load(reader)
    }
}

def flutterVersionCode = localProperties.getProperty('flutter.versionCode', '1')
def flutterVersionName = localProperties.getProperty('flutter.versionName', '1.0')

android {
    namespace "com.example.expert"
    compileSdkVersion 35
    ndkVersion "28.0.12874087"

    compileOptions {
        sourceCompatibility JavaVersion.VERSION_1_8
        targetCompatibility JavaVersion.VERSION_1_8
        coreLibraryDesugaringEnabled true
    }

    kotlinOptions {
        jvmTarget = '1.8' // Ensure valid JVM target
    }

    sourceSets {
        main.java.srcDirs += 'src/main/kotlin'
        
    }

    defaultConfig {
        applicationId "com.example.expert"
        multiDexEnabled true
        minSdkVersion 23
        targetSdkVersion 34
        versionCode flutterVersionCode.toInteger()
        versionName flutterVersionName
    }

    buildTypes {
        release {
            shrinkResources false
            minifyEnabled false
            debuggable false
            crunchPngs true
            signingConfig signingConfigs.debug
            proguardFiles getDefaultProguardFile('proguard-android-optimize.txt')
        }
    }
}

flutter {
    source '../..'
}

// Force Kotlin JVM target for all subprojects to fix compatibility issues
subprojects {
    tasks.withType(org.jetbrains.kotlin.gradle.tasks.KotlinCompile).configureEach {
        kotlinOptions {
            jvmTarget = "1.8" // Force all subprojects to use the correct JVM target
        }
    }
}

dependencies {
    // Kotlin Standard Library (optional, already included in Flutter projects)
    implementation "org.jetbrains.kotlin:kotlin-stdlib:1.8.22" // Ensure compatibility with the latest Kotlin version

    // ML Kit Face Detection
    implementation 'com.google.mlkit:face-detection:16.1.7'
    implementation 'com.google.android.gms:play-services-mlkit-face-detection:17.1.0'

    // Android Support Libraries
    implementation 'androidx.core:core-ktx:1.7.0'
    implementation 'com.android.support:multidex:2.0.1'
    implementation 'androidx.appcompat:appcompat:1.4.1'
    implementation 'com.google.android.material:material:1.5.0'
    implementation 'androidx.constraintlayout:constraintlayout:2.1.3'

    // Testing Dependencies
    testImplementation 'junit:junit:4.13.2'
    androidTestImplementation 'androidx.test.ext:junit:1.1.3'
    androidTestImplementation 'androidx.test.espresso:espresso-core:3.4.0'

    // Glide for Image Loading
    implementation 'com.github.bumptech.glide:glide:4.12.0'
    annotationProcessor 'com.github.bumptech.glide:compiler:4.12.0'

    coreLibraryDesugaring 'com.android.tools:desugar_jdk_libs:1.2.2'
}
